var Ct=Object.defineProperty;var At=(e,t,a)=>t in e?Ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var De=(e,t,a)=>(At(e,typeof t!="symbol"?t+"":t,a),a);import{S as fe,i as ce,s as de,a as me,b as M,f as V,z as pe,n as q,I as _,J as y,K as re,d as O,e as k,L as B,c as I,v as z,t as ee,j as L,M as D,k as p,N as R,O as oe,P as Ce,B as ut,o as Ae,A as Se,h as U,Q as Te,l as ft,p as he,q as X,w as Ie,x as ye,y as ct,r as ge,u as Pt,R as Nt,G as Et,T as Bt}from"../../mastodon.js";import"./httpClient.js";import{g as le,a as dt,f as Dt,b as Rt,t as Ot,n as Me,m as ue,c as Re,M as Gt,l as Ft}from"./MastodonModal.js";import{c as ve}from"./_commonjsHelpers.js";function Oe(e){let t,a,n,r,o,u,c,f,i,l,d,h,m;return a=new e[2]({props:{label:"Mastodon Instance Name",sublabel:"Instance name is used for managing the deployed instance and to create a subdomain",placeholder:"Instance name is used for managing the deployed instance and to create a subdomain",controller:e[1].get("name")}}),r=new e[2]({props:{label:"Admin Email",placeholder:"Admin Email",controller:e[1].get("admin").get("email")}}),u=new e[3]({props:{label:"Region",controller:e[1].get("region"),options:[{label:"All",value:null},...["Asia","Europe","Africa","Oceania","Americas","Polar","Antarctic Ocean","Antarctic"].map(jt)]}}),i=new e[4]({props:{label:"Enable ThreeFold Connect",controller:e[1].get("tfConnect")}}),h=new e[4]({props:{label:"Certified",controller:e[1].get("certified")}}),{c(){t=k("section"),B(a.$$.fragment),n=I(),B(r.$$.fragment),o=I(),B(u.$$.fragment),c=I(),f=k("b-tooltip"),B(i.$$.fragment),l=I(),d=k("b-tooltip"),B(h.$$.fragment),z(f,"tooltip","Enable ThreeFold Connect on your Mastodon instance."),z(f,"flow","right"),ee(f,"is-block",!0),ee(f,"mb-2",!0),z(d,"tooltip","Deploys your instance on a Certified Threefold Node."),z(d,"flow","right"),L(t,"display",e[0]?"initial":"none")},m(g,v){M(g,t,v),D(a,t,null),p(t,n),D(r,t,null),p(t,o),D(u,t,null),p(t,c),p(t,f),D(i,f,null),p(t,l),p(t,d),D(h,d,null),m=!0},p(g,v){const P={};v&2&&(P.controller=g[1].get("name")),a.$set(P);const $={};v&2&&($.controller=g[1].get("admin").get("email")),r.$set($);const C={};v&2&&(C.controller=g[1].get("region")),u.$set(C);const G={};v&2&&(G.controller=g[1].get("tfConnect")),i.$set(G);const j={};v&2&&(j.controller=g[1].get("certified")),h.$set(j),v&1&&L(t,"display",g[0]?"initial":"none")},i(g){m||(_(a.$$.fragment,g),_(r.$$.fragment,g),_(u.$$.fragment,g),_(i.$$.fragment,g),_(h.$$.fragment,g),m=!0)},o(g){y(a.$$.fragment,g),y(r.$$.fragment,g),y(u.$$.fragment,g),y(i.$$.fragment,g),y(h.$$.fragment,g),m=!1},d(g){g&&O(t),R(a),R(r),R(u),R(i),R(h)}}}function Lt(e){let t,a,n=e[1]&&Oe(e);return{c(){n&&n.c(),t=pe(),this.c=q},m(r,o){n&&n.m(r,o),M(r,t,o),a=!0},p(r,[o]){r[1]?n?(n.p(r,o),o&2&&_(n,1)):(n=Oe(r),n.c(),_(n,1),n.m(t.parentNode,t)):n&&(oe(),y(n,1,1,()=>{n=null}),re())},i(r){a||(_(n),a=!0)},o(r){y(n),a=!1},d(r){n&&n.d(r),r&&O(t)}}}const jt=e=>({label:e,value:e});function Kt(e,t,a){const{Input:n,Select:r,CheckBox:o}=window.tfSvelteBulmaWc;let{show:u}=t,{mastodon:c}=t;return e.$$set=f=>{"show"in f&&a(0,u=f.show),"mastodon"in f&&a(1,c=f.mastodon)},[u,c,n,r,o]}class mt extends fe{constructor(t){super(),ce(this,{target:this.shadowRoot,props:me(this.attributes),customElement:!0},Kt,Lt,de,{show:0,mastodon:1},null),t&&(t.target&&M(t.target,this,t.anchor),t.props&&(this.$set(t.props),V()))}static get observedAttributes(){return["show","mastodon"]}get show(){return this.$$.ctx[0]}set show(t){this.$$set({show:t}),V()}get mastodon(){return this.$$.ctx[1]}set mastodon(t){this.$$set({mastodon:t}),V()}}customElements.define("tf-basic-tab",mt);var gt=(e=>(e.Credentials="MASTODON_LOGIN_CREDENTIALS",e))(gt||{});class we{static write(t,a){return window.sessionStorage.setItem(t,JSON.stringify(a))}static read(t){const a=window.sessionStorage.getItem(t);return a?JSON.parse(a):null}}De(we,"Keys",gt);const{MachineModel:Ut,DiskModel:Ht,MachinesModel:zt,NetworkModel:Vt,GatewayNameModel:qt}=window.grid3_client;function Wt(e=[]){return e.map(({name:t,size:a,mountPoint:n})=>{const r=new Ht;return r.name=t,r.size=a,r.mountpoint=n,r})}function Jt(e=[]){return e.reduce((t,a)=>(t[a.key]=a.value,t),{})}function Yt(){const e=new Vt;return e.name=dt(15,"NW"),e.ip_range="10.20.0.0/16",e.addAccess=!1,e}async function Qt(e){const t=new Ut;t.name=e.name,t.node_id=e.nodeId,t.disks=Wt(e.disks),t.public_ip=e.ipv4||!1,t.public_ip6=e.ipv6||!1,t.planetary=e.planetary||!0,t.cpu=e.cpu,t.memory=e.memory,t.rootfs_size=e.rootFsSize,t.flist=e.image.flist,t.entrypoint=e.image.entryPoint,t.env=Jt(e.envs),t.solutionProviderID=e.solutionProviderID;const a=new zt;a.name=e.name,a.network=Yt(),a.machines=[t],a.metadata=e.metadata;const n=await le(e.mnemonics);return await n.machines.deploy(a),n.machines.getObj(e.name)}function Xt(e,t){return le(e).then(a=>a.zos.pingNode({nodeId:t})).then(()=>!0).catch(()=>{throw new Error(`Node(${t}) is offline`)})}async function Zt(e,t){return`md${await(await le(e)).twins.get_my_twin_id()}${t.toLocaleLowerCase()}`}async function xt(e){const t=new qt;return t.name=e.domainName,t.node_id=e.publicNodeId,t.tls_passthrough=!1,t.backends=[`http://[${e.planetaryIp}]:3000`],t.solutionProviderID=e.solutionProviderID,t.metadata=e.metadata,(await le(e.mnemonics)).gateway.deploy_name(t)}function en(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var pt=en,tn=typeof ve=="object"&&ve&&ve.Object===Object&&ve,nn=tn,an=nn,rn=typeof self=="object"&&self&&self.Object===Object&&self,on=an||rn||Function("return this")(),bt=on,sn=bt,ln=function(){return sn.Date.now()},un=ln,fn=/\s/;function cn(e){for(var t=e.length;t--&&fn.test(e.charAt(t)););return t}var dn=cn,mn=dn,gn=/^\s+/;function pn(e){return e&&e.slice(0,mn(e)+1).replace(gn,"")}var bn=pn,hn=bt,_n=hn.Symbol,ht=_n,Ge=ht,_t=Object.prototype,wn=_t.hasOwnProperty,vn=_t.toString,_e=Ge?Ge.toStringTag:void 0;function yn(e){var t=wn.call(e,_e),a=e[_e];try{e[_e]=void 0;var n=!0}catch{}var r=vn.call(e);return n&&(t?e[_e]=a:delete e[_e]),r}var Sn=yn,kn=Object.prototype,$n=kn.toString;function Tn(e){return $n.call(e)}var In=Tn,Fe=ht,Mn=Sn,Cn=In,An="[object Null]",Pn="[object Undefined]",Le=Fe?Fe.toStringTag:void 0;function Nn(e){return e==null?e===void 0?Pn:An:Le&&Le in Object(e)?Mn(e):Cn(e)}var En=Nn;function Bn(e){return e!=null&&typeof e=="object"}var Dn=Bn,Rn=En,On=Dn,Gn="[object Symbol]";function Fn(e){return typeof e=="symbol"||On(e)&&Rn(e)==Gn}var Ln=Fn,jn=bn,je=pt,Kn=Ln,Ke=0/0,Un=/^[-+]0x[0-9a-f]+$/i,Hn=/^0b[01]+$/i,zn=/^0o[0-7]+$/i,Vn=parseInt;function qn(e){if(typeof e=="number")return e;if(Kn(e))return Ke;if(je(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=je(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=jn(e);var a=Hn.test(e);return a||zn.test(e)?Vn(e.slice(2),a?2:8):Un.test(e)?Ke:+e}var Wn=qn,Jn=pt,$e=un,Ue=Wn,Yn="Expected a function",Qn=Math.max,Xn=Math.min;function Zn(e,t,a){var n,r,o,u,c,f,i=0,l=!1,d=!1,h=!0;if(typeof e!="function")throw new TypeError(Yn);t=Ue(t)||0,Jn(a)&&(l=!!a.leading,d="maxWait"in a,o=d?Qn(Ue(a.maxWait)||0,t):o,h="trailing"in a?!!a.trailing:h);function m(b){var N=n,A=r;return n=r=void 0,i=b,u=e.apply(A,N),u}function g(b){return i=b,c=setTimeout($,t),l?m(b):u}function v(b){var N=b-f,A=b-i,w=t-N;return d?Xn(w,o-A):w}function P(b){var N=b-f,A=b-i;return f===void 0||N>=t||N<0||d&&A>=o}function $(){var b=$e();if(P(b))return C(b);c=setTimeout($,v(b))}function C(b){return c=void 0,h&&n?m(b):(n=r=void 0,u)}function G(){c!==void 0&&clearTimeout(c),i=0,n=f=r=c=void 0}function j(){return c===void 0?u:C($e())}function T(){var b=$e(),N=P(b);if(n=arguments,r=this,f=b,N){if(c===void 0)return g(f);if(d)return clearTimeout(c),c=setTimeout($,t),m(f)}return c===void 0&&(c=setTimeout($,t)),u}return T.cancel=G,T.flush=j,T}var wt=Zn;const xn={Asia:["Afghanistan","Armenia","Azerbaijan","Bahrain","Bangladesh","Bhutan","Brunei Darussalam","Cambodia","China","Georgia","Hong Kong","India","Indonesia","Iran (Islamic Republic of)","Iraq","Israel","Japan","Jordan","Kazakhstan","Kuwait","Kyrgyzstan","Lao People's Democratic Republic","Lebanon","Macao","Malaysia","Maldives","Mongolia","Myanmar","Nepal","Korea (Democratic People's Republic of)","Oman","Pakistan","Palestine, State of","Philippines","Qatar","Saudi Arabia","Singapore","Korea (Republic of)","Sri Lanka","Syrian Arab Republic","Taiwan","Tajikistan","Thailand","Timor-Leste","Turkey","Turkmenistan","United Arab Emirates","Uzbekistan","Vietnam","Yemen"],Europe:["\xC5land Islands","Albania","Andorra","Austria","Belarus","Belgium","Bosnia and Herzegovina","Bulgaria","Croatia","Cyprus","Czech Republic","Denmark","Estonia","Faroe Islands","Finland","France","Germany","Gibraltar","Greece","Guernsey","Vatican City","Hungary","Iceland","Ireland","Isle of Man","Italy","Jersey","Latvia","Liechtenstein","Lithuania","Luxembourg","North Macedonia","Malta","Moldova (Republic of)","Monaco","Montenegro","Netherlands","Norway","Poland","Portugal","Republic of Kosovo","Romania","Russian Federation","San Marino","Serbia","Slovakia","Slovenia","Spain","Svalbard and Jan Mayen","Sweden","Switzerland","Ukraine","United Kingdom of Great Britain and Northern Ireland"],Africa:["Algeria","Angola","Benin","Botswana","British Indian Ocean Territory","Burkina Faso","Burundi","Cameroon","Cabo Verde","Central African Republic","Chad","Comoros","Congo","Congo (Democratic Republic of the)","Djibouti","Egypt","Equatorial Guinea","Eritrea","Ethiopia","French Southern Territories","Gabon","Gambia","Ghana","Guinea","Guinea-Bissau","Ivory Coast","Kenya","Lesotho","Liberia","Libya","Madagascar","Malawi","Mali","Mauritania","Mauritius","Mayotte","Morocco","Mozambique","Namibia","Niger","Nigeria","R\xE9union","Rwanda","Saint Helena, Ascension and Tristan da Cunha","Sao Tome and Principe","Senegal","Seychelles","Sierra Leone","Somalia","South Africa","Sudan","South Sudan","Swaziland","Tanzania, United Republic of","Togo","Tunisia","Uganda","Western Sahara","Zambia","Zimbabwe"],Oceania:["American Samoa","Australia","Christmas Island","Cocos (Keeling) Islands","Cook Islands","Fiji","French Polynesia","Guam","Kiribati","Marshall Islands","Micronesia (Federated States of)","Nauru","New Caledonia","New Zealand","Niue","Norfolk Island","Northern Mariana Islands","Palau","Papua New Guinea","Pitcairn","Samoa","Solomon Islands","Tokelau","Tonga","Tuvalu","Vanuatu","Wallis and Futuna"],Americas:["Anguilla","Antigua and Barbuda","Argentina","Aruba","Bahamas","Barbados","Belize","Bermuda","Bolivia (Plurinational State of)","Bonaire, Sint Eustatius and Saba","Brazil","United States Minor Outlying Islands","Virgin Islands (British)","Virgin Islands (U.S.)","Canada","Cayman Islands","Chile","Colombia","Costa Rica","Cuba","Cura\xE7ao","Dominica","Dominican Republic","Ecuador","El Salvador","Falkland Islands (Malvinas)","French Guiana","Greenland","Grenada","Guadeloupe","Guatemala","Guyana","Haiti","Honduras","Jamaica","Martinique","Mexico","Montserrat","Nicaragua","Panama","Paraguay","Peru","Puerto Rico","Saint Barth\xE9lemy","Saint Kitts and Nevis","Saint Lucia","Saint Martin (French part)","Saint Pierre and Miquelon","Saint Vincent and the Grenadines","Sint Maarten (Dutch part)","South Georgia and the South Sandwich Islands","Suriname","Trinidad and Tobago","Turks and Caicos Islands","United States of America","Uruguay","Venezuela (Bolivarian Republic of)"]};function He(e){let t,a,n,r;return t=new e[5]({props:{label:"Select farm id",options:[{label:"All",value:null},...e[2].map(ze)],controller:e[7],validation:!1,loading:!e[4],disabled:!e[4]}}),n=new e[5]({props:{label:"Select Node ID",placeholder:"Select Node ID to deploy",validation:!e[3],loading:e[3],disabled:e[3],controller:e[6],options:e[1].map(Ve)}}),{c(){B(t.$$.fragment),a=I(),B(n.$$.fragment)},m(o,u){D(t,o,u),M(o,a,u),D(n,o,u),r=!0},p(o,u){const c={};u&4&&(c.options=[{label:"All",value:null},...o[2].map(ze)]),u&16&&(c.loading=!o[4]),u&16&&(c.disabled=!o[4]),t.$set(c);const f={};u&8&&(f.validation=!o[3]),u&8&&(f.loading=o[3]),u&8&&(f.disabled=o[3]),u&2&&(f.options=o[1].map(Ve)),n.$set(f)},i(o){r||(_(t.$$.fragment,o),_(n.$$.fragment,o),r=!0)},o(o){y(t.$$.fragment,o),y(n.$$.fragment,o),r=!1},d(o){R(t,o),o&&O(a),R(n,o)}}}function ea(e){let t,a,n=e[0]&&He(e);return{c(){n&&n.c(),t=pe(),this.c=q},m(r,o){n&&n.m(r,o),M(r,t,o),a=!0},p(r,[o]){r[0]?n?(n.p(r,o),o&1&&_(n,1)):(n=He(r),n.c(),_(n,1),n.m(t.parentNode,t)):n&&(oe(),y(n,1,1,()=>{n=null}),re())},i(r){a||(_(n),a=!0)},o(r){y(n),a=!1},d(r){n&&n.d(r),r&&O(t)}}}const ze=e=>({label:`${e.name}(${e.farmID})`,value:e.farmID}),Ve=e=>({label:`Node ID(${e.nodeId})`,value:e.nodeId});function ta(e,t,a){let n,r;const{Select:o}=window.tfSvelteBulmaWc,{fb:u,FormGroup:c,validators:f}=window.tfSvelteRxForms,{default:i}=window.tfgridGql;let{mastodon:l}=t;const d=u.control(null,[f.required("Node ID is required.")]);Ce(e,d,T=>a(9,r=T));const h=u.control(null);let m=[],g=[];const v=wt(async T=>{a(1,m=[]),a(3,$=!0),T.setDisabled(!0);const b=d.value;d.setValue(null);const N=T.value;delete N.region,N.mru/=1024,a(1,m=await Dt(l.value.mnemonics,N)),T.get("certified").value&&a(1,m=m.filter(w=>w.certificationType==="Certified"));const A=T.get("region").value;if(A!==null){const w=xn[A];a(1,m=m.filter(s=>w.includes(s.location.country)))}m.some(w=>w.nodeId===b)?d.setValue(b):m.length>0&&d.setValue(m[0].nodeId),d.markAsTouched(),d.markAsDirty(),a(3,$=!1),T.setDisabled(!1)},1500);async function P(){const T=new i(window.config.network),b={updatedAt_gt:Date.now()-1*60*60*1e3},N=["nodeID_ASC"],{totalCount:A}=await T.nodesConnection({totalCount:!0},{where:b,orderBy:N});a(2,g=A===0?[]:await T.nodes({farmID:!0},{where:b,orderBy:N,limit:A}).then(w=>T.farms({name:!0,farmID:!0},{where:{farmID_in:Array.from(new Set(w.map(s=>s.farmID)))},orderBy:["farmID_ASC"]}))),a(4,C=!0),v(j)}let $=!1,C=!1,G,j;return ut(()=>G==null?void 0:G()),Ae(async()=>{await P(),j=new c({cru:l.get("cpu"),mru:l.get("memory"),sru:l.get("disk"),publicIPs:l.get("ipv4"),region:l.get("region"),certified:l.get("certified"),farmId:h}),G=j.subscribe(()=>{C&&(a(3,$=!0),l.get("nodeId").setValue(null),v(j))})}),e.$$set=T=>{"mastodon"in T&&a(0,l=T.mastodon)},e.$$.update=()=>{e.$$.dirty&512&&a(8,n=r),e.$$.dirty&257&&l&&n.valid&&l.get("nodeId").setValue(n.value)},[l,m,g,$,C,o,d,h,n,r]}class vt extends fe{constructor(t){super(),ce(this,{target:this.shadowRoot,props:me(this.attributes),customElement:!0},ta,ea,de,{mastodon:0},null),t&&(t.target&&M(t.target,this,t.anchor),t.props&&(this.$set(t.props),V()))}static get observedAttributes(){return["mastodon"]}get mastodon(){return this.$$.ctx[0]}set mastodon(t){this.$$set({mastodon:t}),V()}}customElements.define("tf-select-node-id",vt);function qe(e){let t,a;return t=new e[2]({props:{label:"Select Gateway Node",placeholder:"Please select a gateway node",controller:e[0].get("gateway"),options:e[1].map(We)}}),{c(){B(t.$$.fragment)},m(n,r){D(t,n,r),a=!0},p(n,r){const o={};r&1&&(o.controller=n[0].get("gateway")),r&2&&(o.options=n[1].map(We)),t.$set(o)},i(n){a||(_(t.$$.fragment,n),a=!0)},o(n){y(t.$$.fragment,n),a=!1},d(n){R(t,n)}}}function na(e){let t,a,n=e[0]&&qe(e);return{c(){n&&n.c(),t=pe(),this.c=q},m(r,o){n&&n.m(r,o),M(r,t,o),a=!0},p(r,[o]){r[0]?n?(n.p(r,o),o&1&&_(n,1)):(n=qe(r),n.c(),_(n,1),n.m(t.parentNode,t)):n&&(oe(),y(n,1,1,()=>{n=null}),re())},i(r){a||(_(n),a=!0)},o(r){y(n),a=!1},d(r){n&&n.d(r),r&&O(t)}}}const We=([e,t])=>({label:e,value:t});function aa(e,t,a){let n,r=q,o=()=>(r(),r=Se(c,i=>a(3,n=i)),c);e.$$.on_destroy.push(()=>r());const{Select:u}=window.tfSvelteBulmaWc;let{mastodon:c}=t;o();let f=[];return Ae(async()=>{const i=await Rt(c.value.mnemonics);a(1,f=Object.keys(i).map(l=>[i[l].domain,l+":"+i[l].domain])),f.length&&c.get("gateway").setValue(f[0][1])}),e.$$set=i=>{"mastodon"in i&&o(a(0,c=i.mastodon))},e.$$.update=()=>{e.$$.dirty&8},[c,f,u,n]}class yt extends fe{constructor(t){super(),ce(this,{target:this.shadowRoot,props:me(this.attributes),customElement:!0},aa,na,de,{mastodon:0},null),t&&(t.target&&M(t.target,this,t.anchor),t.props&&(this.$set(t.props),V()))}static get observedAttributes(){return["mastodon"]}get mastodon(){return this.$$.ctx[0]}set mastodon(t){this.$$set({mastodon:t}),V()}}customElements.define("tf-select-gateway",yt);function Je(e){let t,a,n,r,o,u,c,f,i,l,d,h,m,g,v,P,$,C,G,j,T,b,N,A;a=new e[3]({props:{label:"CPU (vCores)",placeholder:"CPU in vCores",type:"number",controller:e[1].get("cpu")}}),r=new e[3]({props:{label:"Memory (MB)",placeholder:"Memory in MB",type:"number",controller:e[1].get("memory")}}),u=new e[3]({props:{label:"Disk (GB)",placeholder:"Disk in GB",type:"number",controller:e[1].get("disk")}}),f=new e[4]({props:{label:"Planetary Network",controller:e[1].get("planetary")}}),l=new e[4]({props:{label:"Public IPv4",controller:e[1].get("ipv4")}}),h=new yt({props:{mastodon:e[1]}}),g=new vt({props:{mastodon:e[1]}}),P=new e[3]({props:{label:"Admin Username",placeholder:"Admin Username",controller:e[1].get("admin").get("username")}}),C=new e[3]({props:{label:"Admin Password",placeholder:"Admin Password",type:"password",controller:e[1].get("admin").get("password")}}),b=new e[4]({props:{label:"SMTP Server",controller:e[1].get("smtp").get("enable")}});let w=e[2]&&Ye(e);return{c(){t=k("section"),B(a.$$.fragment),n=I(),B(r.$$.fragment),o=I(),B(u.$$.fragment),c=I(),B(f.$$.fragment),i=I(),B(l.$$.fragment),d=I(),B(h.$$.fragment),m=I(),B(g.$$.fragment),v=I(),B(P.$$.fragment),$=I(),B(C.$$.fragment),G=I(),j=k("div"),T=k("b-tooltip"),B(b.$$.fragment),N=I(),w&&w.c(),z(T,"flow","left"),z(T,"tooltip","Mastodon does not require an SMTP server. If you want to use an SMTP server, you can configure it."),U(j,"class","is-flex is-justify-content-right"),L(t,"display",e[0]?"initial":"none")},m(s,S){M(s,t,S),D(a,t,null),p(t,n),D(r,t,null),p(t,o),D(u,t,null),p(t,c),D(f,t,null),p(t,i),D(l,t,null),p(t,d),D(h,t,null),p(t,m),D(g,t,null),p(t,v),D(P,t,null),p(t,$),D(C,t,null),p(t,G),p(t,j),p(j,T),D(b,T,null),p(t,N),w&&w.m(t,null),A=!0},p(s,S){const W={};S&2&&(W.controller=s[1].get("cpu")),a.$set(W);const F={};S&2&&(F.controller=s[1].get("memory")),r.$set(F);const Z={};S&2&&(Z.controller=s[1].get("disk")),u.$set(Z);const ie={};S&2&&(ie.controller=s[1].get("planetary")),f.$set(ie);const te={};S&2&&(te.controller=s[1].get("ipv4")),l.$set(te);const se={};S&2&&(se.mastodon=s[1]),h.$set(se);const E={};S&2&&(E.mastodon=s[1]),g.$set(E);const ne={};S&2&&(ne.controller=s[1].get("admin").get("username")),P.$set(ne);const K={};S&2&&(K.controller=s[1].get("admin").get("password")),C.$set(K);const ae={};S&2&&(ae.controller=s[1].get("smtp").get("enable")),b.$set(ae),s[2]?w?(w.p(s,S),S&4&&_(w,1)):(w=Ye(s),w.c(),_(w,1),w.m(t,null)):w&&(oe(),y(w,1,1,()=>{w=null}),re()),S&1&&L(t,"display",s[0]?"initial":"none")},i(s){A||(_(a.$$.fragment,s),_(r.$$.fragment,s),_(u.$$.fragment,s),_(f.$$.fragment,s),_(l.$$.fragment,s),_(h.$$.fragment,s),_(g.$$.fragment,s),_(P.$$.fragment,s),_(C.$$.fragment,s),_(b.$$.fragment,s),_(w),A=!0)},o(s){y(a.$$.fragment,s),y(r.$$.fragment,s),y(u.$$.fragment,s),y(f.$$.fragment,s),y(l.$$.fragment,s),y(h.$$.fragment,s),y(g.$$.fragment,s),y(P.$$.fragment,s),y(C.$$.fragment,s),y(b.$$.fragment,s),y(w),A=!1},d(s){s&&O(t),R(a),R(r),R(u),R(f),R(l),R(h),R(g),R(P),R(C),R(b),w&&w.d()}}}function Ye(e){let t,a,n,r,o,u,c,f;return t=new e[3]({props:{label:"SMTP Email",placeholder:"SMTP Email",controller:e[1].get("smtp").get("email")}}),n=new e[3]({props:{label:"SMTP Password",placeholder:"SMTP Password",type:"password",controller:e[1].get("smtp").get("password")}}),o=new e[3]({props:{label:"SMTP Server",placeholder:"SMTP Server",controller:e[1].get("smtp").get("server")}}),c=new e[3]({props:{label:"SMTP Port",placeholder:"SMTP Port",type:"number",controller:e[1].get("smtp").get("port")}}),{c(){B(t.$$.fragment),a=I(),B(n.$$.fragment),r=I(),B(o.$$.fragment),u=I(),B(c.$$.fragment)},m(i,l){D(t,i,l),M(i,a,l),D(n,i,l),M(i,r,l),D(o,i,l),M(i,u,l),D(c,i,l),f=!0},p(i,l){const d={};l&2&&(d.controller=i[1].get("smtp").get("email")),t.$set(d);const h={};l&2&&(h.controller=i[1].get("smtp").get("password")),n.$set(h);const m={};l&2&&(m.controller=i[1].get("smtp").get("server")),o.$set(m);const g={};l&2&&(g.controller=i[1].get("smtp").get("port")),c.$set(g)},i(i){f||(_(t.$$.fragment,i),_(n.$$.fragment,i),_(o.$$.fragment,i),_(c.$$.fragment,i),f=!0)},o(i){y(t.$$.fragment,i),y(n.$$.fragment,i),y(o.$$.fragment,i),y(c.$$.fragment,i),f=!1},d(i){R(t,i),i&&O(a),R(n,i),i&&O(r),R(o,i),i&&O(u),R(c,i)}}}function ra(e){let t,a,n=e[1]&&Je(e);return{c(){n&&n.c(),t=pe(),this.c=q},m(r,o){n&&n.m(r,o),M(r,t,o),a=!0},p(r,[o]){r[1]?n?(n.p(r,o),o&2&&_(n,1)):(n=Je(r),n.c(),_(n,1),n.m(t.parentNode,t)):n&&(oe(),y(n,1,1,()=>{n=null}),re())},i(r){a||(_(n),a=!0)},o(r){y(n),a=!1},d(r){n&&n.d(r),r&&O(t)}}}function oa(e,t,a){let n,r,o,u=q,c=()=>(u(),u=Se(d,m=>a(6,o=m)),d);e.$$.on_destroy.push(()=>u());const{Input:f,CheckBox:i}=window.tfSvelteBulmaWc;let{show:l}=t,{mastodon:d}=t;c();let h;return ut(()=>h==null?void 0:h()),Ae(function m(){d||requestAnimationFrame(m);let g;h=d.get("smtp").get("enable").subscribe(v=>{g!==v.value&&(g=v.value,Ot(d,g))})}),e.$$set=m=>{"show"in m&&a(0,l=m.show),"mastodon"in m&&c(a(1,d=m.mastodon))},e.$$.update=()=>{e.$$.dirty&64&&a(5,n=o),e.$$.dirty&32&&a(2,r=n?n.value.smtp.value.enable.value:!1)},[l,d,r,f,i,n,o]}class St extends fe{constructor(t){super(),ce(this,{target:this.shadowRoot,props:me(this.attributes),customElement:!0},oa,ra,de,{show:0,mastodon:1},null),t&&(t.target&&M(t.target,this,t.anchor),t.props&&(this.$set(t.props),V()))}static get observedAttributes(){return["show","mastodon"]}get show(){return this.$$.ctx[0]}set show(t){this.$$set({show:t}),V()}get mastodon(){return this.$$.ctx[1]}set mastodon(t){this.$$set({mastodon:t}),V()}}customElements.define("tf-advanced-tab",St);function Qe(e,t,a){const n=e.slice();return n[2]=t[a].src,n[7]=t[a].alt,n[8]=t[a].url,n[10]=a,n}function ia(e){let t,a,n,r,o,u,c,f=e[3],i=[];for(let l=0;l<f.length;l+=1)i[l]=Xe(Qe(e,f,l));return{c(){t=k("h4"),t.innerHTML='Scan the QRcode using <a target="_blank" href="https://library.threefold.me/info/threefold#/tokens/threefold__threefold_connect" rel="noreferrer">ThreeFold Connect</a> to fund your account',a=I(),n=k("div"),r=k("img"),u=I(),c=k("div");for(let l=0;l<i.length;l+=1)i[l].c();U(t,"class","has-text-centered has-text-weight-bold"),Te(r.src,o=e[2])||U(r,"src",o),U(r,"alt","qrcode"),U(n,"class","is-flex is-justify-content-center"),U(c,"class","has-text-centered")},m(l,d){M(l,t,d),M(l,a,d),M(l,n,d),p(n,r),M(l,u,d),M(l,c,d);for(let h=0;h<i.length;h+=1)i[h].m(c,null)},p(l,d){if(d&4&&!Te(r.src,o=l[2])&&U(r,"src",o),d&8){f=l[3];let h;for(h=0;h<f.length;h+=1){const m=Qe(l,f,h);i[h]?i[h].p(m,d):(i[h]=Xe(m),i[h].c(),i[h].m(c,null))}for(;h<i.length;h+=1)i[h].d(1);i.length=f.length}},d(l){l&&O(t),l&&O(a),l&&O(n),l&&O(u),l&&O(c),ft(i,l)}}}function sa(e){let t;return{c(){t=k("p"),t.textContent="Please Pass some data"},m(a,n){M(a,t,n)},p:q,d(a){a&&O(t)}}}function la(e){let t;return{c(){t=k("p"),t.textContent="Loading..."},m(a,n){M(a,t,n)},p:q,d(a){a&&O(t)}}}function Xe(e){let t,a,n,r;function o(){return e[4](e[8])}return{c(){t=k("img"),Te(t.src,a="mastodon-weblet/"+e[2])||U(t,"src",a),U(t,"width","150"),U(t,"alt",e[7]),ee(t,"mr-2",e[10]===0),L(t,"cursor","pointer")},m(u,c){M(u,t,c),n||(r=he(t,"mousedown",o),n=!0)},p(u,c){e=u},d(u){u&&O(t),n=!1,r()}}}function ua(e){let t;function a(o,u){if(o[1])return la;if(!o[0])return sa;if(o[2])return ia}let n=a(e),r=n&&n(e);return{c(){t=k("div"),r&&r.c(),this.c=q,U(t,"class","mt-5 is-block")},m(o,u){M(o,t,u),r&&r.m(t,null)},p(o,[u]){n===(n=a(o))&&r?r.p(o,u):(r&&r.d(1),r=n&&n(o),r&&(r.c(),r.m(t,null)))},i:q,o:q,d(o){o&&O(t),r&&r.d()}}}function fa(e,t,a){const n=window.qrcode;let{data:r}=t,o=!1,u;async function c(){a(1,o=!0),a(2,u=await n.toDataURL(r,{width:250})),a(1,o=!1)}const f=[{src:"android.svg",alt:"play-store",url:"https://play.google.com/store/apps/details?id=org.jimber.threebotlogin&hl=en&gl=US"},{src:"ios.svg",alt:"app-store",url:"https://apps.apple.com/us/app/threefold-connect/id1459845885"}],i=l=>window.open(l,"_blank");return e.$$set=l=>{"data"in l&&a(0,r=l.data)},e.$$.update=()=>{e.$$.dirty&1&&r&&c()},[r,o,u,f,i]}class kt extends fe{constructor(t){super(),ce(this,{target:this.shadowRoot,props:me(this.attributes),customElement:!0},fa,ua,de,{data:0},null),t&&(t.target&&M(t.target,this,t.anchor),t.props&&(this.$set(t.props),V()))}static get observedAttributes(){return["data"]}get data(){return this.$$.ctx[0]}set data(t){this.$$set({data:t}),V()}}customElements.define("tf-qrcode",kt);function Ze(e){let t,a,n,r,o,u,c,f,i,l,d,h,m,g,v,P,$,C,G,j,T,b,N;r=new e[14]({props:{label:"Mnemonics",placeholder:"Mnemonics",sublabel:"Mnemonics are your private key. They are used to represent you on the ThreeFold Grid. You can paste existing mnemonics or click the 'Create Account' button to create an account and generate mnemonics.",type:"password",controller:e[1].get("mnemonics"),disabled:e[13]||e[12],validation:!(e[13]||e[12]),hint:e[5].pending?"Validating mnemonics...":e[2]==="Error"?e[8]:void 0,hintColor:e[5].pending?"info":e[2]==="Error"?"danger":void 0}});let A=e[2]==="Done"&&e[8]&&xe(e),w=(e[5].valid||!e[5].valid&&e[5].error===Me)&&e[7]&&et(e);return v=new e[14]({props:{label:"Public SSH Key",type:"textarea",placeholder:"Your public SSH Key",sublabel:"SSH Keys are used to authenticate you to the Mastodon instance for management purposes. If you don't have an SSH Key or are not familiar, we can generate one for you.",controller:e[1].get("sshKey"),loading:e[3]||e[11]||e[4],disabled:!e[5].valid||e[3]||e[11]||e[4],hint:e[10]||(e[3]||e[11]||e[4]?e[9]:void 0),validation:!(e[3]||e[11]||e[4]),hintColor:e[3]||e[11]||e[4]?"info":void 0}}),{c(){t=k("section"),a=k("div"),n=k("div"),B(r.$$.fragment),o=I(),u=k("button"),c=X("Create Account"),l=I(),A&&A.c(),d=I(),w&&w.c(),h=I(),m=k("div"),g=k("div"),B(v.$$.fragment),P=I(),$=k("button"),C=X("Generate SSH Key"),L(n,"width","100%"),U(u,"type","button"),u.disabled=f=e[5].valid||e[13]||e[12],ee(u,"ml-2",!0),L(u,"margin-top","78px"),U(a,"class","is-flex is-jutify-content-center"),L(g,"width","100%"),U($,"type","button"),$.disabled=G=!e[5].valid||e[3]||e[11]||e[4]||e[6].valid,ee($,"ml-2",!0),L($,"margin-top","78px"),U(m,"class","is-flex is-jutify-content-center mb-2"),L(t,"display",e[0]?"initial":"none")},m(s,S){M(s,t,S),p(t,a),p(a,n),D(r,n,null),p(a,o),p(a,u),p(u,c),p(t,l),A&&A.m(t,null),p(t,d),w&&w.m(t,null),p(t,h),p(t,m),p(m,g),D(v,g,null),p(m,P),p(m,$),p($,C),T=!0,b||(N=[Ie(i=e[15].call(null,u,{color:"info",size:"small",loading:e[13]||e[12]})),he(u,"click",e[17]),Ie(j=e[15].call(null,$,{color:"info",size:"small",loading:e[3]||e[11]||e[4]})),he($,"click",e[18])],b=!0)},p(s,S){const W={};S&2&&(W.controller=s[1].get("mnemonics")),S&12288&&(W.disabled=s[13]||s[12]),S&12288&&(W.validation=!(s[13]||s[12])),S&292&&(W.hint=s[5].pending?"Validating mnemonics...":s[2]==="Error"?s[8]:void 0),S&36&&(W.hintColor=s[5].pending?"info":s[2]==="Error"?"danger":void 0),r.$set(W),(!T||S&12320&&f!==(f=s[5].valid||s[13]||s[12]))&&(u.disabled=f),i&&ye(i.update)&&S&12288&&i.update.call(null,{color:"info",size:"small",loading:s[13]||s[12]}),s[2]==="Done"&&s[8]?A?A.p(s,S):(A=xe(s),A.c(),A.m(t,d)):A&&(A.d(1),A=null),(s[5].valid||!s[5].valid&&s[5].error===Me)&&s[7]?w?(w.p(s,S),S&160&&_(w,1)):(w=et(s),w.c(),_(w,1),w.m(t,h)):w&&(oe(),y(w,1,1,()=>{w=null}),re());const F={};S&2&&(F.controller=s[1].get("sshKey")),S&2072&&(F.loading=s[3]||s[11]||s[4]),S&2104&&(F.disabled=!s[5].valid||s[3]||s[11]||s[4]),S&3608&&(F.hint=s[10]||(s[3]||s[11]||s[4]?s[9]:void 0)),S&2072&&(F.validation=!(s[3]||s[11]||s[4])),S&2072&&(F.hintColor=s[3]||s[11]||s[4]?"info":void 0),v.$set(F),(!T||S&2168&&G!==(G=!s[5].valid||s[3]||s[11]||s[4]||s[6].valid))&&($.disabled=G),j&&ye(j.update)&&S&2072&&j.update.call(null,{color:"info",size:"small",loading:s[3]||s[11]||s[4]}),S&1&&L(t,"display",s[0]?"initial":"none")},i(s){T||(_(r.$$.fragment,s),_(w),_(v.$$.fragment,s),T=!0)},o(s){y(r.$$.fragment,s),y(w),y(v.$$.fragment,s),T=!1},d(s){s&&O(t),R(r),A&&A.d(),w&&w.d(),R(v),b=!1,ct(N)}}}function xe(e){let t,a,n,r;return{c(){t=k("b-notification"),a=k("b-icon"),n=I(),r=X(e[8]),z(a,"icon","fa-sharp fa-solid fa-triangle-exclamation"),z(t,"color","warning"),z(t,"light",""),ee(t,"my-2",!0)},m(o,u){M(o,t,u),p(t,a),p(t,n),p(t,r)},p(o,u){u&256&&ge(r,o[8])},d(o){o&&O(t)}}}function et(e){let t,a;return t=new kt({props:{data:"TFT:"+e[16]+"?message=twin_"+e[7]+"&sender=me&amount=100"}}),{c(){B(t.$$.fragment)},m(n,r){D(t,n,r),a=!0},p(n,r){const o={};r&128&&(o.data="TFT:"+n[16]+"?message=twin_"+n[7]+"&sender=me&amount=100"),t.$set(o)},i(n){a||(_(t.$$.fragment,n),a=!0)},o(n){y(t.$$.fragment,n),a=!1},d(n){R(t,n)}}}function ca(e){let t,a,n=e[1]&&Ze(e);return{c(){n&&n.c(),t=pe(),this.c=q},m(r,o){n&&n.m(r,o),M(r,t,o),a=!0},p(r,[o]){r[1]?n?(n.p(r,o),o&2&&_(n,1)):(n=Ze(r),n.c(),_(n,1),n.m(t.parentNode,t)):n&&(oe(),y(n,1,1,()=>{n=null}),re())},i(r){a||(_(n),a=!0)},o(r){y(n),a=!1},d(r){n&&n.d(r),r&&O(t)}}}function da(e,t,a){let n,r,o,u,c,f,i,l=q,d=()=>(l(),l=Se(m,E=>a(26,i=E)),m);e.$$.on_destroy.push(()=>l());let{show:h}=t,{mastodon:m}=t;d();const{Input:g,btn:v}=window.tfSvelteBulmaWc,{HTTPMessageBusClient:P}=window.tsRmbHttpClient,{generateKeyPair:$}=window.webSshKeygen;let C=!1,G=window.config.network==="main"?"GBNOTAYUMXVO5QDYWYO2SOCOYIJ3XFIP65GKOQN7H65ZZSO6BK4SLWSC":window.config.network==="test"?"GA2CWNBUHX7NZ3B5GR4I23FMU7VY5RPA77IUJTIXTTTGKYSKDSV6LUA4":"GDHJP6TF3UXYXTNEZ2P36J5FH7W4BJJQ4AYYAXC66I2Q2AH5B6O6BCFG",j,T,b="None",N;async function A(){try{a(2,b="Creating");const{GridClient:E}=window.grid3_client,ne=new P(0,"","",""),K=new E(window.config.network,"","test",ne);K._connect();const ae=await K.tfchain.createAccount("::1");m.get("mnemonics").setValue(ae.mnemonic),await m.get("mnemonics").validate(),a(8,N="Please make sure to store your mnemonics somewhere safe to be able to access your deployments later on. There is no way for neither you nor ThreeFold nor anybody else to recover lost mnemonics."),a(2,b="Done")}catch(E){a(2,b="Error"),a(8,N=E)}}let w,s=!1,S,W,F=!1,Z=!1,ie,te=!1;async function se(){a(11,te=!0),a(9,w="Generating Your SSH Key...");const E=await $({alg:"RSASSA-PKCS1-v1_5",hash:"SHA-256",name:"Threefold",size:4096});try{await(await le(n.value.mnemonics.value)).kvstore.set({key:"metadata",value:JSON.stringify({sshkey:E.publicKey})})}catch(ae){a(10,ie=ae.message)}m.get("sshKey").setValue(E.publicKey),await m.get("sshKey").validate();const ne=`data:text/raw;charset=utf-8,${encodeURIComponent(E.privateKey)}`,K=document.createElement("a");K.download="id_rsa",K.href=ne,document.body.appendChild(K),K.click(),K.remove(),a(11,te=!1)}return e.$$set=E=>{"show"in E&&a(0,h=E.show),"mastodon"in E&&d(a(1,m=E.mastodon))},e.$$.update=()=>{if(e.$$.dirty&67108864&&a(25,n=i),e.$$.dirty&34078722&&m&&(C?we.write(we.Keys.Credentials,m.value.mnemonics):requestAnimationFrame(()=>{a(19,C=!0);const E=we.read(we.Keys.Credentials);E&&m.get("mnemonics").setValue(E)})),e.$$.dirty&33554432&&a(5,r=n==null?void 0:n.value.mnemonics),e.$$.dirty&32&&a(24,f=r?r.valid||!r.valid&&r.error===Me:!1),e.$$.dirty&51380256&&f&&T!==r.value&&(a(20,T=r.value),le(n.value.mnemonics.value).then(E=>E.twins.get_my_twin_id()).then(E=>a(7,j=E))),e.$$.dirty&33554432&&a(6,o=n==null?void 0:n.value.sshKey),e.$$.dirty&10485866&&(r==null?void 0:r.valid)&&!(o!=null&&o.valid)&&!s&&!F){a(23,F=!0),a(3,s=!0),a(9,w="Reading Your SSH Key...");const E="metadata";le(r.value).then(async ne=>{const K=await ne.kvstore.get({key:E});K!==""&&requestAnimationFrame(()=>{a(21,S=JSON.parse(K).sshkey),m.get("sshKey").setValue(S)})}).finally(()=>a(3,s=!1))}e.$$.dirty&6291568&&(r==null?void 0:r.valid)&&(o==null?void 0:o.valid)&&((o==null?void 0:o.value)!==S||(r==null?void 0:r.value)!==W)&&!Z&&(a(21,S=o.value),a(22,W=r.value),a(4,Z=!0),a(9,w="Storing Your SSH Key..."),le(r.value).then(E=>E.kvstore.set({key:"metadata",value:JSON.stringify({sshkey:S})})).finally(()=>a(4,Z=!1))),e.$$.dirty&32&&a(13,u=r==null?void 0:r.pending),e.$$.dirty&4&&a(12,c=b==="Creating")},[h,m,b,s,Z,r,o,j,N,w,ie,te,c,u,g,v,G,A,se,C,T,S,W,F,f,n,i]}class $t extends fe{constructor(t){super(),ce(this,{target:this.shadowRoot,props:me(this.attributes),customElement:!0},da,ca,de,{show:0,mastodon:1},null),t&&(t.target&&M(t.target,this,t.anchor),t.props&&(this.$set(t.props),V()))}static get observedAttributes(){return["show","mastodon"]}get show(){return this.$$.ctx[0]}set show(t){this.$$set({show:t}),V()}get mastodon(){return this.$$.ctx[1]}set mastodon(t){this.$$set({mastodon:t}),V()}}customElements.define("tf-credentials-tab",$t);function tt(e){let t,a,n,r,o=e[0].toFixed(3)+" TFT",u,c,f,i,l,d=e[1].toFixed(3)+" TFT",h,m,g,v,P;return{c(){t=k("div"),a=k("p"),n=X("Balance: "),r=k("span"),u=X(o),c=I(),f=k("p"),i=X("Locked: "),l=k("span"),h=X(d),m=I(),g=k("button"),g.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-clockwise" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"></path><path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"></path></svg>',L(r,"font-weight","bold"),L(l,"font-weight","bold"),U(g,"class","btn"),L(g,"border","none"),L(g,"background","rgb(0 0 0 / 0%)"),L(g,"width","100%"),L(g,"outline","none"),L(g,"cursor","pointer"),U(t,"class","card"),L(t,"padding","10px"),L(t,"width","70%"),L(t,"background","rgb(245 245 245)"),L(t,"text-align","center")},m($,C){M($,t,C),p(t,a),p(a,n),p(a,r),p(r,u),p(t,c),p(t,f),p(f,i),p(f,l),p(l,h),p(t,m),p(t,g),v||(P=he(g,"click",e[3]),v=!0)},p($,C){C&1&&o!==(o=$[0].toFixed(3)+" TFT")&&ge(u,o),C&2&&d!==(d=$[1].toFixed(3)+" TFT")&&ge(h,d)},d($){$&&O(t),v=!1,P()}}}function ma(e){let t,a=e[0]!=null&&e[1]!=null&&tt(e);return{c(){a&&a.c(),t=pe(),this.c=q},m(n,r){a&&a.m(n,r),M(n,t,r)},p(n,[r]){n[0]!=null&&n[1]!=null?a?a.p(n,r):(a=tt(n),a.c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null)},i:q,o:q,d(n){a&&a.d(n),n&&O(t)}}}function ga(e,t,a){let n,r,o,u;const c=ue.get("mnemonics");Ce(e,c,l=>a(6,r=l));let f;async function i(){Re(n.value).then(l=>{a(0,o=l.free),a(1,u=l.feeFrozen)})}return e.$$.update=()=>{e.$$.dirty&64&&a(5,n=r),e.$$.dirty&48&&(n.valid&&f!==n.value?(a(4,f=n.value),Re(n.value).then(l=>{a(0,o=l.free),a(1,u=l.feeFrozen)})):n.valid||(a(0,o=void 0),a(1,u=void 0)))},[o,u,c,i,f,n,r]}class Tt extends fe{constructor(t){super(),ce(this,{target:this.shadowRoot,props:me(this.attributes),customElement:!0},ga,ma,de,{},null),t&&t.target&&M(t.target,this,t.anchor)}}customElements.define("tf-mastodon-balance",Tt);function nt(e,t,a){const n=e.slice();return n[8]=t[a],n[10]=a,n}function at(e){let t,a,n=e[1].value.mnemonics.valid&&rt(e);return{c(){n&&n.c(),t=pe()},m(r,o){n&&n.m(r,o),M(r,t,o),a=!0},p(r,o){r[1].value.mnemonics.valid?n?(n.p(r,o),o&2&&_(n,1)):(n=rt(r),n.c(),_(n,1),n.m(t.parentNode,t)):n&&(oe(),y(n,1,1,()=>{n=null}),re())},i(r){a||(_(n),a=!0)},o(r){y(n),a=!1},d(r){n&&n.d(r),r&&O(t)}}}function rt(e){let t,a,n,r,o,u,c=[e[2],e[3]],f=[];for(let i=0;i<2;i+=1)f[i]=ot(nt(e,c,i));return o=new Tt({}),{c(){t=k("div"),a=k("div");for(let i=0;i<2;i+=1)f[i].c();n=I(),r=k("div"),B(o.$$.fragment),U(a,"class","column is-10"),U(r,"class","column"),L(r,"display","flex"),L(r,"justify-content","end"),U(t,"class","columns is-vcentered"),L(t,"margin-bottom","10px")},m(i,l){M(i,t,l),p(t,a);for(let d=0;d<2;d+=1)f[d].m(a,null);p(t,n),p(t,r),D(o,r,null),u=!0},p(i,l){if(l&30){c=[i[2],i[3]];let d;for(d=0;d<2;d+=1){const h=nt(i,c,d);f[d]?f[d].p(h,l):(f[d]=ot(h),f[d].c(),f[d].m(a,null))}for(;d<2;d+=1)f[d].d(1)}},i(i){u||(_(o.$$.fragment,i),u=!0)},o(i){y(o.$$.fragment,i),u=!1},d(i){i&&O(t),ft(f,i),R(o)}}}function ot(e){let t,a,n,r=e[1].value.mnemonics.valid&&!e[4]?"The deployment will cost ":"",o,u,c,f=(e[4]?"Loading...":e[8].toFixed(2))+"",i,l,d=e[1].value.mnemonics.valid?`USD/Month ${e[10]===1?"with a 50k balance of TFT, after applying discount":""}`:"",h,m;return{c(){t=k("div"),a=k("b-tags"),n=k("b-tag"),o=X(r),u=I(),c=k("strong"),i=X(f),l=I(),h=X(d),m=I(),U(c,"class","mr-1 ml-1"),z(a,"addons",""),z(a,"align","centered"),z(a,"size","large"),L(t,"margin-bottom",e[10]===0?-5:void 0)},m(g,v){M(g,t,v),p(t,a),p(a,n),p(n,o),p(n,u),p(n,c),p(c,i),p(n,l),p(n,h),p(t,m)},p(g,v){v&18&&r!==(r=g[1].value.mnemonics.valid&&!g[4]?"The deployment will cost ":"")&&ge(o,r),v&28&&f!==(f=(g[4]?"Loading...":g[8].toFixed(2))+"")&&ge(i,f),v&2&&d!==(d=g[1].value.mnemonics.valid?`USD/Month ${g[10]===1?"with a 50k balance of TFT, after applying discount":""}`:"")&&ge(h,d)},d(g){g&&O(t)}}}function pa(e){let t,a,n=e[0]&&at(e);return{c(){t=k("div"),n&&n.c(),this.c=q},m(r,o){M(r,t,o),n&&n.m(t,null),a=!0},p(r,[o]){r[0]?n?(n.p(r,o),o&1&&_(n,1)):(n=at(r),n.c(),_(n,1),n.m(t,null)):n&&(oe(),y(n,1,1,()=>{n=null}),re())},i(r){a||(_(n),a=!0)},o(r){y(n),a=!1},d(r){r&&O(t),n&&n.d()}}}function ba(e,t,a){let n,r,o=q,u=()=>(o(),o=Se(c,m=>a(5,r=m)),c);e.$$.on_destroy.push(()=>o());let{mastodon:c}=t;u();let f,i,l=!0,d;const h=wt(async function(){const{cpu:m,memory:g,disk:v,mnemonics:P}=n.value;if(!(m.valid&&g.valid&&v.valid))return;const $=`${m.value}:${g.value}:${v.value}`;if(d===$)return;a(4,l=!0),d=$;const C=await le(P.value);a(2,f=(await C.calculator.calculateWithMyBalance({cru:m.value,sru:v.value+2,mru:g.value/1024,hru:0})).sharedPrice),a(3,i=(await C.calculator.calculate({cru:m.value,sru:v.value+2,mru:g.value/1024,hru:0,balance:50*1e4})).sharedPrice),a(4,l=!1)},1e3);return e.$$set=m=>{"mastodon"in m&&u(a(0,c=m.mastodon))},e.$$.update=()=>{e.$$.dirty&32&&a(1,n=r),e.$$.dirty&2&&n&&n.value.mnemonics.valid&&h()},[c,n,f,i,l,r]}class It extends fe{constructor(t){super(),ce(this,{target:this.shadowRoot,props:me(this.attributes),customElement:!0},ba,pa,de,{mastodon:0},null),t&&(t.target&&M(t.target,this,t.anchor),t.props&&(this.$set(t.props),V()))}static get observedAttributes(){return["mastodon"]}get mastodon(){return this.$$.ctx[0]}set mastodon(t){this.$$set({mastodon:t}),V()}}customElements.define("tf-price-calculator",It);function it(e){let t,a,n,r;return t=new mt({props:{mastodon:ue,show:e[1]==="basic"}}),n=new St({props:{mastodon:ue,show:e[1]==="advanced"}}),{c(){B(t.$$.fragment),a=I(),B(n.$$.fragment)},m(o,u){D(t,o,u),M(o,a,u),D(n,o,u),r=!0},p(o,u){const c={};u&2&&(c.show=o[1]==="basic"),t.$set(c);const f={};u&2&&(f.show=o[1]==="advanced"),n.$set(f)},i(o){r||(_(t.$$.fragment,o),_(n.$$.fragment,o),r=!0)},o(o){y(t.$$.fragment,o),y(n.$$.fragment,o),r=!1},d(o){R(t,o),o&&O(a),R(n,o)}}}function ha(e){let t;return{c(){t=k("b-notification"),t.innerHTML=`<b-icon icon="fa-solid fa-circle-check"></b-icon> Your mastodon instance is
            up and running.`,z(t,"color","success"),z(t,"light","")},m(a,n){M(a,t,n)},d(a){a&&O(t)}}}function _a(e){let t;return{c(){t=k("b-notification"),t.innerHTML=`<b-icon icon="fas fa-spinner fa-pulse"></b-icon> Waiting for your mastodon instance
            to be up and running...`,z(t,"color","warning"),z(t,"light","")},m(a,n){M(a,t,n)},d(a){a&&O(t)}}}function st(e){let t,a;return t=new Gt({props:{data:e[6]}}),t.$on("close",e[18]),{c(){B(t.$$.fragment)},m(n,r){D(t,n,r),a=!0},p(n,r){const o={};r&64&&(o.data=n[6]),t.$set(o)},i(n){a||(_(t.$$.fragment,n),a=!0)},o(n){y(t.$$.fragment,n),a=!1},d(n){R(t,n)}}}function wa(e){let t,a,n,r,o,u,c,f,i,l,d,h,m,g,v,P,$,C,G,j,T=(e[5]||"Loading..")+"",b,N,A,w,s,S,W,F,Z=e[2]?"Back":"Deploy",ie,te,se,E,ne,K,ae,Pe;c=new It({props:{mastodon:ue}});function Mt(Q){e[16](Q)}let Ne={tabs:[{id:"credentials",label:"Credentials"},...e[10]?[{id:"basic",label:"Basic"},{id:"advanced",label:"Advanced"}]:[]]};e[1]!==void 0&&(Ne.active=e[1]),l=new va({props:Ne}),Pt.push(()=>Nt(l,"active",Mt)),v=new $t({props:{mastodon:ue,show:e[1]==="credentials"}});let J=e[10]&&it(e);function Ee(Q,H){if(Q[8])return _a;if(Q[9])return ha}let be=Ee(e),x=be&&be(e),Y=e[6]&&e[7]&&st(e);return{c(){t=k("b-box"),a=k("b-content"),n=k("h2"),n.textContent="Deploy a Mastodon Instance",r=I(),o=k("p"),o.textContent=`Mastodon is free and open-source software for running self-hosted social
      networking services. It has microblogging features similar to the Twitter
      service, which are offered by a large number of independently run nodes,
      known as instances, each with its own code of conduct, terms of service,
      privacy options, and moderation policies.`,u=I(),B(c.$$.fragment),f=I(),i=k("section"),B(l.$$.fragment),h=I(),m=k("form"),g=k("section"),B(v.$$.fragment),P=I(),J&&J.c(),$=I(),C=k("section"),G=k("b-notification"),j=X("[+] "),b=X(T),N=X("."),w=I(),s=k("div"),S=k("div"),x&&x.c(),W=I(),F=k("button"),ie=X(Z),ne=I(),Y&&Y.c(),this.c=q,ee(i,"d-none",e[2]),L(i,"margin-top","35px"),ee(g,"d-none",e[2]),z(G,"color",A=e[3]?"danger":e[4]?"success":"info"),z(G,"light",""),ee(C,"d-none",!e[2]),U(S,"class","mr-2"),L(S,"width","100%"),U(F,"type",te=e[2]?"button":"submit"),F.disabled=se=!e[0].valid||e[2]&&!e[3]&&!e[4]||e[6]||e[7],U(s,"class","is-flex mt-2 is-align-items-center")},m(Q,H){M(Q,t,H),p(t,a),p(a,n),p(a,r),p(a,o),p(a,u),D(c,a,null),p(t,f),p(t,i),D(l,i,null),p(t,h),p(t,m),p(m,g),D(v,g,null),p(g,P),J&&J.m(g,null),p(m,$),p(m,C),p(C,G),p(G,j),p(G,b),p(G,N),p(m,w),p(m,s),p(s,S),x&&x.m(S,null),p(s,W),p(s,F),p(F,ie),p(t,ne),Y&&Y.m(t,null),K=!0,ae||(Pe=[Ie(E=ya.call(null,F,{color:e[2]?"info":"primary",loading:e[2]&&!e[3]&&!e[4]})),he(F,"click",function(){ye(e[2]?e[17]:void 0)&&(e[2]?e[17]:void 0).apply(this,arguments)}),he(m,"submit",Et(e[11]))],ae=!0)},p(Q,[H]){e=Q;const ke={};H&1024&&(ke.tabs=[{id:"credentials",label:"Credentials"},...e[10]?[{id:"basic",label:"Basic"},{id:"advanced",label:"Advanced"}]:[]]),!d&&H&2&&(d=!0,ke.active=e[1],Bt(()=>d=!1)),l.$set(ke),(!K||H&4)&&ee(i,"d-none",e[2]);const Be={};H&2&&(Be.show=e[1]==="credentials"),v.$set(Be),e[10]?J?(J.p(e,H),H&1024&&_(J,1)):(J=it(e),J.c(),_(J,1),J.m(g,null)):J&&(oe(),y(J,1,1,()=>{J=null}),re()),(!K||H&4)&&ee(g,"d-none",e[2]),(!K||H&32)&&T!==(T=(e[5]||"Loading..")+"")&&ge(b,T),(!K||H&24&&A!==(A=e[3]?"danger":e[4]?"success":"info"))&&z(G,"color",A),(!K||H&4)&&ee(C,"d-none",!e[2]),be!==(be=Ee(e))&&(x&&x.d(1),x=be&&be(e),x&&(x.c(),x.m(S,null))),(!K||H&4)&&Z!==(Z=e[2]?"Back":"Deploy")&&ge(ie,Z),(!K||H&4&&te!==(te=e[2]?"button":"submit"))&&U(F,"type",te),(!K||H&221&&se!==(se=!e[0].valid||e[2]&&!e[3]&&!e[4]||e[6]||e[7]))&&(F.disabled=se),E&&ye(E.update)&&H&28&&E.update.call(null,{color:e[2]?"info":"primary",loading:e[2]&&!e[3]&&!e[4]}),e[6]&&e[7]?Y?(Y.p(e,H),H&192&&_(Y,1)):(Y=st(e),Y.c(),_(Y,1),Y.m(t,null)):Y&&(oe(),y(Y,1,1,()=>{Y=null}),re())},i(Q){K||(_(c.$$.fragment,Q),_(l.$$.fragment,Q),_(v.$$.fragment,Q),_(J),_(Y),K=!0)},o(Q){y(c.$$.fragment,Q),y(l.$$.fragment,Q),y(v.$$.fragment,Q),y(J),y(Y),K=!1},d(Q){Q&&O(t),R(c),R(l),R(v),J&&J.d(),x&&x.d(),Y&&Y.d(),ae=!1,ct(Pe)}}}const{Tabs:va,btn:ya}=window.tfSvelteBulmaWc,{events:lt}=window.grid3_client;function Sa(e,t,a){let n,r,o,u,c;Ce(e,ue,b=>a(15,c=b));let{provider:f}=t,i="credentials",l=!1,d=!1,h=!1,m="",g,v=!1,P,$=!1;async function C(){a(2,l=!0),a(3,d=!1),a(4,h=!1),P&&(P(),a(8,P=void 0)),a(9,$=!1);const{value:b}=ue;try{lt.addListener("logs",F=>a(5,m=F)),a(5,m=`Checking the status of Node(${b.nodeId})`),await Xt(b.mnemonics,b.nodeId),a(5,m=`Node(${b.nodeId}) is online`);const N=await Zt(b.mnemonics,b.name),[A,w]=b.gateway.split(":"),s=await Qt({...ue.value,image:{flist:"https://hub.grid.tf/tf-official-apps/mastodon-latest.flist",entryPoint:"/sbin/zinit init"},rootFsSize:2,disks:[{name:dt(15,"disk"),mountPoint:"/var/lib/docker",size:b.disk}],envs:[{key:"LOCAL_DOMAIN",value:`${N}.${w}`},{key:"SUPERUSER_USERNAME",value:b.admin.username},{key:"SUPERUSER_EMAIL",value:b.admin.email},{key:"SUPERUSER_PASSWORD",value:b.admin.password},{key:"SSH_KEY",value:b.sshKey},{key:"IS_TF_CONNECT",value:`${b.tfConnect}`},...b.smtp.enable?[{key:"SMTP_SERVER",value:b.smtp.server},{key:"SMTP_LOGIN",value:b.smtp.email},{key:"SMTP_PASSWORD",value:b.smtp.password},{key:"SMTP_PORT",value:b.smtp.port.toString()}]:[]],solutionProviderID:f?+f:void 0,metadata:JSON.stringify({type:"vm",name:ue.value.name,projectName:"Mastodon"})});await xt({domainName:N,mnemonics:b.mnemonics,planetaryIp:s[0].planetary,publicNodeId:+A,solutionProviderID:f?+f:void 0,metadata:JSON.stringify({type:"gateway",name:N,projectName:"Mastodon"})}),a(6,g=s),a(4,h=!0),a(5,m="Successfully deployed Mastodon instance.");const[S,W]=Ft(`https://${N}.${w}`);a(8,P=W),S.then(()=>{var F;(F=window.mastodonList)==null||F.reload(),a(9,$=!0),a(8,P=void 0),a(7,v=!0)})}catch(N){a(5,m=N.message),a(3,d=!0)}lt.removeAllListeners("logs")}function G(b){i=b,a(1,i)}const j=b=>{b.preventDefault(),a(2,l=!1),a(4,h=!1),a(3,d=!1),a(9,$=!1),P&&(P(),a(8,P=void 0))},T=()=>{a(6,g=void 0),a(7,v=!1)};return e.$$set=b=>{"provider"in b&&a(12,f=b.provider)},e.$$.update=()=>{e.$$.dirty&32768&&a(0,n=c),e.$$.dirty&1&&a(14,r=n.value.mnemonics),e.$$.dirty&1&&a(13,o=n.value.sshKey),e.$$.dirty&24576&&a(10,u=r.valid&&o.valid)},[n,i,l,d,h,m,g,v,P,$,u,C,f,o,r,c,G,j,T]}class ka extends fe{constructor(t){super(),ce(this,{target:this.shadowRoot,props:me(this.attributes),customElement:!0},Sa,wa,de,{provider:12},null),t&&(t.target&&M(t.target,this,t.anchor),t.props&&(this.$set(t.props),V()))}static get observedAttributes(){return["provider"]}get provider(){return this.$$.ctx[12]}set provider(t){this.$$set({provider:t}),V()}}customElements.define("tf-mastodon",ka);export{ka as default};
